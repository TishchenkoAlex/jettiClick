<p-toolbar>
  <div class="ui-toolbar-group-left">
    <button pButton type="button" icon="fa-plus" class="ui-button-success" (click)="add()"></button>
    <button pButton type="button" icon="fa-copy" class="ui-button-secondary" (click)="copy()" *ngIf="selection?.length === 1"></button>
    <button pButton type="button" icon="fa-trash" class="ui-button-danger" (click)="delete()" *ngIf="selection?.length > 0"></button>
  </div>
</p-toolbar>

<p-table [value]="dataSource" selectionMode="multiple" [metaKeySelection]="true" [(selection)]="selection" dataKey="index"
  [scrollable]="true" (onEditComplete)="onEditComplete($event)" (onEditCancel)="onEditCancel($event)" (onEditInit)="onEditInit($event)">

  <ng-template pTemplate="header">
    <tr>
      <th [pSortableColumn]="col.field" *ngFor="let col of columns" [ngStyle]="col.style">
        {{col.label}}
        <p-sortIcon [field]="col.field"></p-sortIcon>
      </th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-rowData>
    <tr [pSelectableRow]="rowData">
      <td *ngFor="let col of columns" [ngStyle]="col.style" pEditableColumn [pEditableColumnField]="col.field">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <j-control [control]="col.data" [form]="getControl(rowData.index)"></j-control>
          </ng-template>
          <ng-template pTemplate="output">
            <span [ngSwitch]="col.type">
              <span *ngSwitchCase="'date'">{{getControl(rowData.index).controls[col.field]?.value | date:'dd.MM.yyyy'}}</span>
              <span *ngSwitchCase="'datetime'">{{getControl(rowData.index).controls[col.field]?.value | date:'dd.MM.yyyy hh:mm:ss'}}</span>
              <span *ngSwitchCase="'number'">{{getControl(rowData.index).controls[col.field]?.value | number:'1.2-2'}}</span>
              <span *ngSwitchCase="'script'">{{getControl(rowData.index).controls[col.field]?.value}}</span>
              <span *ngSwitchCase="'boolean'">
                <i [class]="getControl(rowData.index).get(col.field)?.value ? 'fa fa-check-square' : 'fa fa-square-o'"></i>
              </span>
              <span *ngSwitchDefault>{{ getControlValue(rowData.index, col.field) }}
              </span>
            </span>
          </ng-template>
        </p-cellEditor>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="footer">
    <tr *ngIf="totalsCount">
      <th *ngFor="let col of columns" [ngStyle]="col.style">
        <span [ngSwitch]="col.type" *ngIf="col.totals">
          <span *ngSwitchCase="'number'" style="padding-right: 5px">
            {{calcTotals(col.field) | number:'1.2-2'}}
          </span>
          <span *ngSwitchDefault></span>
        </span>
      </th>
    </tr>
  </ng-template>

</p-table>