<p-toolbar>
  <div class="ui-toolbar-group-left">
    <button pButton type="button" icon="fa-plus" class="ui-button-success" (click)="add()"></button>
    <button pButton type="button" icon="fa-copy" class="ui-button-secondary" (click)="copy()" *ngIf="selection.length === 1"></button>
    <button pButton type="button" icon="fa-trash" class="ui-button-danger" (click)="delete()" *ngIf="selection.length > 0"></button>
  </div>
</p-toolbar>

<p-dataTable #dt [value]="dataSource" [editable]="true" dataKey="index" [(selection)]="selection" [scrollable]="true" [resizableColumns]="true"
  sortMode="multiple" [reorderableColumns]="true" sortMode="multiple" [resizableColumns]="true"  scrollWidth="100%"
  [rows]="10" [paginator]="true" [alwaysShowPaginator] = "false"
  (onEditComplete)="onEditComplete($event)" (onEdit)="onEdit($event)" (onEditCancel)="onEditCancel($event)">

  <p-column [style]="{'width':'34px'}" selectionMode="multiple"></p-column>
  <p-column [style]="{'width':'50px', 'text-align': 'right'}" field="index" header="#" sortable="true">
    <ng-template let-row="rowData" pTemplate="body">
      {{ getControl(row.index).controls['index']?.value+1 | number }}
    </ng-template>
  </p-column>

  <p-column *ngFor="let col of columns" [editable]="true" [field]="col.field" [header]="col.label" sortable="true" [style]="col.style">
    <ng-template let-row="rowData" pTemplate="body">
      <span [ngSwitch]="col.type">
        <span *ngSwitchCase="'date'">{{getControl(row.index).controls[col.field]?.value | date:'dd.MM.yyyy'}}</span>
        <span *ngSwitchCase="'datetime'">{{getControl(row.index).controls[col.field]?.value | date:'dd.MM.yyyy hh:mm:ss'}}</span>
        <span *ngSwitchCase="'number'">{{getControl(row.index).controls[col.field]?.value | number:'1.2-2'}}</span>
        <span *ngSwitchCase="'script'">{{getControl(row.index).controls[col.field]?.value}}</span>
        <span *ngSwitchCase="'boolean'">
          <i [class]="getControl(row.index).controls[col.field]?.value ? 'fa fa-check-square' : 'fa fa-square-o'"></i>
        </span>
        <span *ngSwitchDefault>{{ getControlValue(row.index, col.field) }}
        </span>
      </span>
    </ng-template>
    <ng-template let-row="rowData" pTemplate="editor">
      <j-control [control]="col.data" [form]="getControl(row.index)"></j-control>
    </ng-template>
  </p-column>
  <p-column></p-column>

  <p-footerColumnGroup *ngIf="totalsCount">
    <p-row>
      <p-column [style]="{'width':'34px'}"></p-column>
      <p-column [style]="{'width':'50px', 'text-align': 'right'}"></p-column>
      <div *ngFor="let col of columns">
        <p-column [style]="col.style">
          <ng-template let-row="rowData" pTemplate="footer">
            <div *ngIf="col.totals">
              <div style="text-align: right">
                {{calcTotals(col.field) | number:'1.2-2'}}
              </div>
            </div>
          </ng-template>
        </p-column>
      </div>
      <p-column></p-column>
    </p-row>

  </p-footerColumnGroup>

</p-dataTable>