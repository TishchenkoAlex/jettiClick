<p-toolbar>
  <div class="ui-toolbar-group-left">
    <button pButton type="button" icon="fa-plus" class="ui-button-success" (click)="add()"></button>
    <button pButton type="button" icon="fa-clone" class="ui-button-secondary" (click)="copy()" *ngIf="selection.length === 1"></button>
    <button pButton type="button" icon="fa-minus" class="ui-button-danger" (click)="delete()" *ngIf="selection.length > 0"></button>
  </div>
</p-toolbar>

<p-dataTable [value]="dataSource" [editable]="true" dataKey="index" [(selection)]="selection" [scrollable]="true" [resizableColumns]="true"
  sortMode="multiple" (onEditComplete)="onEditComplete($event)" (onEdit)="onEdit($event)" (onEditCancel)="onEditCancel($event)">

  <p-column [style]="{'width':'34px'}" selectionMode="multiple"></p-column>
  <p-column [style]="{'width':'50px', 'text-align': 'right'}" field="index" header="#" sortable="true">
    <ng-template let-row="rowData" pTemplate="body">
      {{formGroup.controls[row.index].controls['index']?.value+1 | number}}
    </ng-template>
  </p-column>

  <p-column *ngFor="let col of columns" [editable]="true" [field]="col.field" [header]="col.label" sortable="true" [style]="col.style">
    <ng-template let-row="rowData" pTemplate="body">
      <span [ngSwitch]="col.type">
        <span *ngSwitchCase="'date'">{{formGroup.controls[row.index].controls[col.field]?.value | date:'dd.MM.yyyy'}}</span>
        <span *ngSwitchCase="'datetime'">{{formGroup.controls[row.index].controls[col.field]?.value | date:'dd.MM.yyyy hh:mm:ss'}}</span>
        <span *ngSwitchCase="'number'">{{formGroup.controls[row.index].controls[col.field]?.value | number:'1.2-2'}}</span>
        <span *ngSwitchCase="'checkbox'">
          {{formGroup.controls[row.index].controls[col.field]?.value}}
        </span>
        <span *ngSwitchDefault>{{ formGroup.controls[row.index].controls[col.field]?.value?.value || formGroup.controls[row.index].controls[col.field]?.value?.toString()
          === '[object Object]' ? formGroup.controls[row.index].controls[col.field]?.value?.value || formGroup.controls[row.index].controls[col.field]?.value?.type
          : formGroup.controls[row.index].controls[col.field]?.value || '' }}
        </span>
      </span>
    </ng-template>
    <ng-template let-row="rowData" pTemplate="editor">
      <j-control [control]="col.data" [form]="formGroup.controls[row.index]"></j-control>
    </ng-template>
  </p-column>

  <p-footerColumnGroup>
    <p-row>
      <p-column [style]="{'width':'34px'}"></p-column>
      <p-column [style]="{'width':'50px', 'text-align': 'right'}"></p-column>
      <div *ngFor="let col of columns">
        <p-column [style]="col.style">
          <ng-template let-row="rowData" pTemplate="footer">
            <div *ngIf="col.totals">
              <div style="text-align: right">
                {{calcTotals(col.field) | number:'1.2-2'}}
              </div>
            </div>
          </ng-template>
        </p-column>
      </div>
    </p-row>
  </p-footerColumnGroup>

</p-dataTable>